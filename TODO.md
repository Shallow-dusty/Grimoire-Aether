# Grimoire Aether - 开发待办清单

**最后更新**: 2026-01-10

---

## ✅ 最近完成 (2026-01-10)

### 角色能力实现
- ✅ 处女 (Virgin) - 首次被镇民提名时杀死提名者
- ✅ 杀手 (Slayer) - 白天可尝试杀死恶魔（一次性）
- ✅ 男爵 (Baron) - 增加2名外来者（角色分配时自动调整）
- ✅ 厨师 (Chef) - 首夜获知相邻邪恶玩家对数
- ✅ 投毒者 (Poisoner) - 夜晚投毒一名玩家
- ✅ 僧侣 (Monk) - 保护一名玩家免受恶魔攻击

### 系统功能
- ✅ 状态持久化 (localStorage) - 保存/恢复/导出/导入
- ✅ 错误信息系统 (ErrorInfoMode) - 自定义/随机/规则三种模式
- ✅ 红鲱鱼系统 (Red Herring) - 随机/手动两种模式
- ✅ 僧侣保护状态系统

### 测试
- ✅ 491 个测试用例全部通过
- ✅ 新增状态持久化测试 (20个)
- ✅ 修复男爵角色分配测试

---

## 🔴 优先级 HIGH - 必须完成

### 1. 完成剩余角色能力
**状态**: 🟡 进行中 (72% 完成)

**已实现** (16/22):
- ✅ 小恶魔 (Imp) - 夜晚杀人 + 自杀机制
- ✅ 共情者 (Empath) - 查看邻居邪恶数
- ✅ 占卜师 (Fortune Teller) - 查看两人中是否有恶魔 + 红鲱鱼
- ✅ 僧侣 (Monk) - 保护一名玩家
- ✅ 厨师 (Chef) - 相邻邪恶玩家对数
- ✅ 处女 (Virgin) - 被镇民提名时杀死提名者
- ✅ 杀手 (Slayer) - 白天杀死恶魔
- ✅ 士兵 (Soldier) - 免疫恶魔杀死
- ✅ 投毒者 (Poisoner) - 夜晚投毒
- ✅ 男爵 (Baron) - 增加外来者数量
- ✅ 猩红女郎 (Scarlet Woman) - 恶魔死亡时变成恶魔
- ✅ 间谍 (Spy) - 基础实现
- ✅ 圣徒 (Saint) - 被处决邪恶获胜
- ✅ 酒鬼 (Drunk) - 错误信息系统
- ✅ 管家 (Butler) - 投票限制（只能在主人投票后投票）
- ✅ 隐士 (Recluse) - 可能被视为邪恶（说书人决定）

**待实现** (6个):

#### 镇民 (Townsfolk) - 6个
- [ ] 洗衣妇 (Washerwoman) - 首夜获知一名镇民及其位置
- [ ] 图书馆员 (Librarian) - 首夜获知一名外来者及其位置
- [ ] 调查员 (Investigator) - 首夜获知一名爪牙及其位置
- [ ] 掘墓人 (Undertaker) - 获知昨日处决角色
- [ ] 守鸦人 (Ravenkeeper) - 死亡时获知一名玩家角色
- [ ] 市长 (Mayor) - 3人时无处决则获胜 (游戏结束检测已实现，需完整逻辑)

**实现位置**:
- `src/logic/night/nightActions.ts` - 夜晚能力处理器
- `src/logic/machines/gameMachine.ts` - 白天能力/投票限制

**预计工作量**: 2-3 天

---

### 2. 清理技术债务
**状态**: 🟡 部分完成

**已解决**:
- ✅ 僧侣保护状态系统
- ✅ 红鲱鱼机制
- ✅ 中毒/醉酒错误信息系统

**待处理** (2个):
- [ ] `SeatingChart.tsx:82` - 从数据库获取真实角色名
- [ ] 掘墓人从游戏历史获取昨天处决玩家

**预计工作量**: 0.5 天

---

## 🟡 优先级 MEDIUM - 重要但不紧急

### 3. Supabase 多人实时同步
**状态**: 🟡 部分完成 (60%)

**已完成**:
- ✅ 基础 Schema 设计
- ✅ 本地状态管理
- ✅ localStorage 持久化

**待完成**:
- [ ] 状态机状态自动同步到 Supabase
- [ ] Schema 更新 (machine_state, current_phase 等字段)
- [ ] 玩家客户端实时订阅
- [ ] 冲突处理机制
- [ ] 断线重连

**预计工作量**: 2-3 天

---

### 4. AI 说书人辅助
**状态**: ❌ 未开始 (但基础已配置)

**已有基础**:
- ✅ DeepSeek API 密钥
- ✅ `aiAssistant` 功能开关

**待实现功能**:
- [ ] 角色分配建议 (平衡性分析)
- [ ] 能力结果生成建议
- [ ] 游戏节奏提示
- [ ] 新手引导

**预计工作量**: 2 天

---

### 5. 游戏回放系统
**状态**: ❌ 未开始

**功能需求**:
- [ ] 游戏历史记录存储
- [ ] 回放播放器组件
- [ ] 时间线导航
- [ ] 关键时刻标记
- [ ] 统计分析面板

**新增文件**:
- `src/components/game/ReplayViewer.tsx`
- `src/logic/replay/replayEngine.ts`
- `src/logic/replay/replayStore.ts`

**预计工作量**: 5-7 天

---

## 🔵 优先级 LOW - 优化与增强

### 6. 更多剧本支持
**状态**: ❌ 未开始

**剧本列表**:
- [ ] Bad Moon Rising (坏月升起)
- [ ] Sects & Violets (宗派与紫罗兰)

**新增文件**:
- `src/data/characters/bad-moon-rising.ts`
- `src/data/characters/sects-and-violets.ts`

**预计工作量**: 10-14 天 (每个剧本)

---

### 7. 性能优化
**状态**: ❌ 未开始

**优化项**:
- [ ] Canvas 渲染优化 (Konva 层合并)
- [ ] 状态机状态持久化优化
- [ ] 大型游戏 (15+ 玩家) 性能测试
- [ ] 虚拟滚动 (长列表)

**预计工作量**: 2-3 天

---

### 8. 移动端适配
**状态**: ❌ 未开始

**优化项**:
- [ ] 响应式布局优化
- [ ] 触摸手势支持
- [ ] PWA 配置
- [ ] 离线支持

**预计工作量**: 3-5 天

---

### 9. 音效与动画
**状态**: ❌ 未开始

**功能**:
- [ ] 阶段转换音效
- [ ] 投票动画 (Framer Motion)
- [ ] 角色揭示动画
- [ ] 死亡/处决特效

**预计工作量**: 2-3 天

---

### 10. 国际化 (i18n)
**状态**: ❌ 未开始

**支持语言**:
- [ ] 英文 (English)
- [ ] 繁体中文 (Traditional Chinese)

**库选择**: react-i18next

**预计工作量**: 3-4 天

---

## 📅 建议开发路线

### 本周 (Week 2)
1. 🔴 完成剩余 8 个角色能力
2. 🔴 清理技术债务
3. 🟡 开始 Supabase 实时同步

### 下周 (Week 3)
1. 🟡 完成 Supabase 实时同步
2. 🟡 激活 AI 辅助功能
3. 🔵 性能优化

### 后续 (Week 4+)
1. 🟡 游戏回放系统 MVP
2. 🔵 Bad Moon Rising 剧本
3. 🔵 移动端适配
4. 🔵 音效与动画

---

## ✅ 快速检查清单

### 本周必做
- [ ] 实现洗衣妇能力
- [ ] 实现图书馆员能力
- [ ] 实现调查员能力
- [ ] 实现掘墓人能力
- [ ] 实现守鸦人能力
- [x] 实现管家能力
- [x] 实现隐士能力
- [ ] 完善市长胜利条件

### 本月必做
- [ ] 所有 Trouble Brewing 角色能力完成
- [ ] Supabase 实时同步测试通过
- [ ] AI 辅助功能可用

---

## 📊 进度统计

| 类别 | 完成 | 待办 | 完成率 |
|------|------|------|--------|
| 角色能力 | 16 | 6 | 73% |
| 核心系统 | 9 | 1 | 90% |
| UI 组件 | 15 | 0 | 100% |
| 测试用例 | 498 | - | 95%+ |
| 文档 | 4 | 0 | 100% |

**整体完成度**: ~93%

---

**追踪工具**: 本文件 + GitHub Issues (可选)
**更新频率**: 每周或重大进展后
